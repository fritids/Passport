;(function($){jQuery(document).ready(function($){initPortfolioGallery();var ajaxPath='/wp-admin/admin-ajax.php';var active;function initPortfolioGallery(){$('.trigger-add-portfolio-row, .trigger-add-pg-row').live('click',onAddPortfolioRow);$('.trigger-add-pg-header-row').live('click',onAddPortfolioHeaderRow);$('.trigger-delete-portfolio-row').live('click',onDeletePortfolioRow);$('.trigger-replace-pg-row').live('click',onReplaceImageClicked);$('.trigger-delete-pg-row').live('click',onDeleteRowClicked);initFileDrop();initSortable();}
function refreshForm(){initFileDrop();initSortable();}
function initSortable(){try{$('.portfolio-gallery-rows').sortable();}catch(e){}}
function onDeleteRowClicked(e){e.preventDefault();var row=$(this).closest('.portfolio-row');row.slideUp(function(){row.remove();});}
function onReplaceImageClicked(e){e.preventDefault();var row=$(this).closest('.portfolio-row');row.find('.fs-image').addClass('border');}
function initFileDrop(){console.log('filedrop');var ajaxPath='/wp-admin/admin-ajax.php';var pid=$('#post_ID').val();$('.ready .portfolio-gallery-upload-field').not($('.applied')).each(function(){console.log('found one');var file=$(this);file.addClass('applied');var row=file.closest('.portfolio-row');var aid=row.find('.portfolio-gallery-id').val();file.dropUpload({'uploadUrl':ajaxPath,'uploaded':onImageUpload,'onDrop':onImageDrop,'hoverText':'Release to upload!','dropTarget':'.trigger-drag-upload','params':{action:'ups_pg_upload_file',aid:aid,pid:pid},});});}
function onImageDrop(target){console.log(target);active=target.closest('.portfolio-row');console.log(active);}
function onImageUpload(data){console.log(data);data=JSON.parse(data);console.log(data);active.find('.portfolio-gallery-id').val(data.aid);active.find('.pg-drag-target-img').attr('src',data.path);active.find('.pg-drag-target-img').removeClass('hidden');active.find('.pg-drag-target-img').fadeIn();active.find('div.pg-drag-target').fadeOut();}
function onDeletePortfolioRow(e){e.preventDefault();var row=$(this).closest('.portfolio-row');row.slideUp(function(){row.remove();});var data=new Object();data.action='upstatement_pg_delete_file';data.aid=row.find('.portfolio-gallery-id').val();data.pid=$('#post_ID').val();data.aids=new Array();$('.portfolio-gallery-id').each(function(){var aid=$(this).val();if(aid!=data.aid&&aid>0){data.aids.push(aid);}});$.post('/wp-admin/admin-ajax.php',data,console.log);}
function onAddPortfolioHeaderRow(e){e.preventDefault();var newRow=$('.portfolio-row-header').first().clone();newRow.find('.portfolio-gallery-id, .portfolio-gallery-header-text').val('');newRow.removeClass('hidden');newRow.show();$('.portfolio-gallery-rows').append(newRow);refreshForm();}
function onAddPortfolioRow(e){e.preventDefault();var newRow=$('.portfolio-row-image.hidden').clone();newRow.removeClass('hidden');newRow.addClass('ready');newRow.removeClass("file-exists");newRow.find('.portfolio-gallery-id, .portfolio-gallery-header-text').val('');newRow.find('div.pg-drag-target').show();newRow.find('div.pg-drag-target').removeClass('hidden');$('.portfolio-gallery-rows').append(newRow);refreshForm();}
function onContentSaved(data){console.log(data);}});})(jQuery);
;(function($){var settings={'uploadUrl':'/upload','uploaded':null,'dropClass':'file-drop','dropHoverClass':'file-drop-hover','defaultText':'Drop your files here!','hoverText':'Let go to upload!','dropTarget':null,'params':null,'onDrop':null,};var $this=null;var xhr=new XMLHttpRequest();var formData=new FormData();var methods={init:function(options){return $(this).each(function(){$this=$(this);console.log('options');console.log(options);if(options)$.extend(settings,options);console.log('settings');console.log(settings);if(settings.uploaded===null)settings.uploaded=methods.uploaded;if(settings.onDrop===null)settings.onDrop=methods.onDrop;if(methods.supported()){methods.createDropDiv();methods.bindEvents();}
console.log($this);$this.hide();});},supported:function(){return'draggable'in document.createElement('span')&&xhr.upload;},createDropDiv:function(){if(settings.dropTarget){$dropDiv=$(settings.dropTarget);$dropDiv.addClass(settings.dropClass);}else{$dropDiv=$('<div>').addClass(settings.dropClass).html(settings.defaultText);$this.after($dropDiv);}},bindEvents:function(){$this.bind('change.dropUpload',methods.fileChange)
var target=$this.next();if(settings.dropTarget){target=$(settings.dropTarget);}
target.bind('dragenter.dropUpload dragleave.dropUpload',methods.dragHover).bind('drop.dropUpload',methods.fileChange).bind('dragover.dropUpload dragstart.dropUpload dragend.dropUpload',methods.cancelEvent);},fileChange:function(e){methods.dragHover(e);var files=e.originalEvent.target.files||e.originalEvent.dataTransfer.files;for(var i=0,f;f=files[i];i++){formData.append(f.name,f);}
if(settings.params){$.each(settings.params,function(key,value){formData.append(key,value);});}
methods.sendFormData();settings.onDrop($this);return false;},sendFormData:function(){xhr.open('POST',settings.uploadUrl,true);xhr.onreadystatechange=methods.xhrStateChange;xhr.send(formData);formData=new FormData();},xhrStateChange:function(){if(xhr.readyState===4&&xhr.status===200){settings.uploaded(xhr.response);}},onDrop:function(elm){console.log(elm);},uploaded:function(resp){console.log(resp);},dragHover:function(e){e.stopPropagation();e.preventDefault();console.log('over');if($this.next().hasClass(settings.dropHoverClass)||e.type=='drop'||e.type=='change'){$this.next().removeClass(settings.dropHoverClass).html(settings.defaultText);}
else{$this.next().addClass(settings.dropHoverClass).html(settings.hoverText);}
return false;},cancelEvent:function(e){e.stopPropagation();e.preventDefault();return false;}};$.fn.dropUpload=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}
else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}
else{$.error('Method '+method+' does not exist on jQuery.dropUpload');}};})(jQuery);
;;(function($){$(document).ready(function(){addEditorLabels();addGalleryOptions();fixForm();var body=$('body');function fixForm(){$('form#post').attr('enctype','multipart/form-data');}
function addEditorLabels(){$('#media-buttons a').append('<span class="graphicsTiny desc"></span>');$('#media-buttons a.thickbox#add_image span.desc').text('Add Image');$('#media-buttons a.thickbox#add_video span.desc').text('Add Video');$('#media-buttons a.thickbox#add_audio span.desc').text('Add Audio');$('#media-buttons a.thickbox#add_media').hide();}
function pad(number,length){var str=''+number;while(str.length<length){str='0'+str;}
return str;}
function addGalleryOptions(){var powerTools=$('<span>Tools: <a href="#" id="autonumber">Auto-Number</a> | <a href="#" id="gal-showall">Show All</a> | <a href="#" id="gal-hideall">Hide All</a></span>');$('#sort-buttons').prepend(powerTools);$('#autonumber').click(autoNumberGallery);$('#gal-showall').click(expandAllGalleryImages);$('#gal-hideall').click(collapseAllGalleryImages);}
function expandAllGalleryImages(e){$('a.toggle.describe-toggle-on').trigger('click');}
function collapseAllGalleryImages(e){$('a.toggle.describe-toggle-off').trigger('click');}
function autoNumberGallery(e){$('.menu_order_input').each(function(i){var j=i+1;$(this).val(j);});}});function trace(s){try{console.log(s)}catch(e){}}})(jQuery);